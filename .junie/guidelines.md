# Smooth-Build Developer Guidelines

## Project Overview
Smooth-build is a command line build tool.
It uses *.smooth files that describe build process.
*.smooth files are written using smooth language.
Smooth language is statically typed functional language that uses Hindley-Milner type inference.
It evaluates lazily with fine-grained caching.
Cache entries are indexed by hash built from a hash of operation being executed and hash of its arguments.
Evaluations that do not depend on each other execute in parallel.

## Project Structure
smooth build project is Multi-module Gradle project with modules organized under `src/`.

### `common` module
`common` module contains shared utilities and core components.
### `antlr-smooth` - ANTLR grammar for the language
  - `compiler-frontend` - Front-end of the compiler
  - `virtual-machine` - Virtual machine implementation
  - `compiler-backend` - Back-end of the compiler
  - `evaluator` - Expression evaluation
  - `cli` - Command-line interface
  - `standard-library` - Standard library for smooth language
  - `system-test` - System-level tests
  - `distribution` - Distribution packaging
  - `common-testing` - Shared testing utilities
    
### `common` module
Contains shared utilities and core components.

### `antlr-smooth`
Contains ANTLR grammar for the language and parser for that grammar generated by ANTLR tool.

### `compiler-frontend`  
Front-end of the compiler for smooth language.
It uses parser provided by `antlr-smooth` module.
It runs semantic analysis of smooth code (including type checking and type inferring)
and produces an intermediate representation of the code.
Intermediate representation is modeled by classes located in a package tree
starting at `org.smoothbuild.compilerfrontend.lang`.
Intermediate representation classes are prefixed with `S` letter.

### `compiler-backend`
Backend compiler for smooth language.
It compiles intermediate representation to smooth bytecode.

### `virtual-machine`  
Contains a virtual machine for smooth bytecode and classes for modeling bytecode expressions.
It is capable of evaluating smooth bytecode in parallel.
Classes representing bytecode expressions or related to them are prefixed with `B` letter.

### `evaluator`  
Contains a smooth evaluator, a top-level component that combines and schedules
all parts of build evaluation process (frontend compiler, backend compiler, evaluation by virtual machine).

### `cli`  
Contains code related to parsing/verifying command line arguments.

### `standard-library`  
Contains implementation of a standard library for smooth language
defined in `std_lib.smooth`.
Implementations for @Native functions are located in package tree of
`org.smoothbuild.stdlib`.

### `system-test`  
System-level tests.

### `distribution`  
Distribution packaging.

### `common-testing`  
Shared testing utilities.

## Tech Stack
- **Java 24** - Primary programming language
- **Gradle** - Build system
- **ANTLR4** - Parser generator for the language
- **Dagger** - Dependency injection
- **Guava** - Utility libraries
- **JUnit 5** - Testing framework
- **Mockito & Truth** - Testing utilities

## Building and Testing

### Building the Project
```bash
./gradlew build
```

### Running Tests
```bash
# Run all tests
./gradlew test

# Run tests for a specific module
./gradlew :src:virtual-machine:test

# Run a specific test class
./gradlew :src:virtual-machine:test --tests "org.smoothbuild.virtualmachine.SomeTest"
```

## Each module organization

### Source Code Organization
Each module follows the standard Maven/Gradle structure:
- `src/main/java` - Production code
- `src/test/java` - Test code
- `src/testFixtures/java` - Shared test utilities

### Test Organization
- Unit tests are located in the `test` directory of each module
- System tests are in the `system-test` module
- Test fixtures are shared via the `testFixtures` source set

## Documentation
- `README.md` - Project overview
- `doc/tutorial.md` - User tutorial
- `doc/api.md` - API documentation
- `doc/install.md` - Installation instructions
- `doc/glossary.md` - Terminology definitions
- `doc/dev/` - Developer-specific documentation

## Best Practices
1. **Follow the functional paradigm**
   The project is built around functional programming principles.
   When possible use classes from `org.smoothbuild.common.collect` instead of JDK collections.
2. **Write tests**
   Maintain high test coverage.
   Name junit test methods using snake_case.
3. **Use dependency injection**
   Follow the Dagger patterns established in the codebase
4. **Documentation**
   Never add Javadocs nor comments unless explicitly asked.
   Update existing Javadocs or comments when they exist for code you modified.
   Make code readable enough so it speaks for itself.
   Update documentation in *.md files when needed.
5. **Format your code**
   Run Spotless before committing
6. **Code style**
   Format code using spotless plugin.
   In *.md files line length must be limited to 80 characters.
7. **Changelog**
   Maintain CHANGELOG.md in the project root that holds user visible changes.
